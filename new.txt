local Players = game:GetService("Players")
local Workspace = game:GetService("Workspace")
local player = Players.LocalPlayer

local RANDOMIZE_INTERVAL = 15  -- Change the timer to 15 seconds
local countdown = RANDOMIZE_INTERVAL
local running = true
local autoStopEnabled = true

local EGG_NAMES = {
    "Bug Egg", "Night Egg", "Mythical Egg", "Paradise Egg", "Oasis Egg", "Primal Egg", "Dinosaur Egg"
}

local PET_POOL = {
    ["Bug Egg"] = {"Snail", "Caterpillar", "Giant Ant"},
    ["Night Egg"] = {"Hedgehog", "Frog", "Echo Frog", "Blood Hedgehog", "Blood Kiwi"},
    ["Mythical Egg"] = {"Squirrel", "Red Giant Ant", "Grey Mouse", "Brown Mouse"},
    ["Paradise Egg"] = {"Ostrich", "Peacock", "Capybara", "Mimic Octopus"},
    ["Oasis Egg"] = {"Meerkat", "Sandsnake", "Oxolotl"},
    ["Primal Egg"] = {"Brontosaurus", "Spinosaurus", "Pterodactyl", "Raptor"},
    ["Dinosaur Egg"] = {"Brontosaurus", "Raptor", "Pterodactyl"}
}

local AUTO_STOP_PET_NAMES = {
    "Dragonfly", "Queen Bee", "Red Fox", "Raccoon", "Fennec Fox", "Mimic Octopus",
    "T-Rex", "Brontosaurus", "Raptor", "Spinosaurus", "Pterodactyl"
}

local HIDDEN_AUTO_STOP_PETS = {}
for _, name in ipairs(AUTO_STOP_PET_NAMES) do
    HIDDEN_AUTO_STOP_PETS[name] = true
end

local function ensureCurrentPet(egg)
    local sv = egg:FindFirstChild("CurrentPet")
    if not sv then
        sv = Instance.new("StringValue")
        sv.Name = "CurrentPet"
        sv.Value = ""
        sv.Parent = egg
    end
    return sv
end

local function isPlayerNearby(egg)
    local part = egg:FindFirstChildWhichIsA("BasePart")
    local char = player.Character
    if not part or not char or not char:FindFirstChild("HumanoidRootPart") then return false end
    return (part.Position - char.HumanoidRootPart.Position).Magnitude <= 25
end

local function updateEggUI(egg)
    local part = egg:FindFirstChildWhichIsA("BasePart")
    local currentPet = egg:FindFirstChild("CurrentPet")
    if not part or not currentPet then return end

    if not isPlayerNearby(egg) then
        local existing = egg:FindFirstChild("PetUI")
        if existing then existing:Destroy() end
        return
    end

    local ui = egg:FindFirstChild("PetUI")
    if not ui then
        ui = Instance.new("BillboardGui")
        ui.Name = "PetUI"
        ui.Adornee = part
        ui.Size = UDim2.new(0, 200, 0, 60)
        ui.StudsOffset = Vector3.new(0, 3, 0)
        ui.AlwaysOnTop = true
        ui.Parent = egg

        local label = Instance.new("TextLabel")
        label.Name = "Label"
        label.Size = UDim2.new(1, 0, 1, 0)
        label.BackgroundTransparency = 1
        label.TextColor3 = Color3.new(1, 1, 0)
        label.TextScaled = true
        label.Font = Enum.Font.GothamBold
        label.Parent = ui
    end

    local label = ui:FindFirstChild("Label")
    if label then
        if not HIDDEN_AUTO_STOP_PETS[currentPet.Value] then
            label.Text = egg.Name .. " → " .. currentPet.Value .. "\nTimer: " .. countdown .. "s"
        else
            label.Text = ""
        end
    end

    if autoStopEnabled and table.find(AUTO_STOP_PET_NAMES, currentPet.Value) then
        running = false
    end
end

local function randomizeAllEggs()
    for _, egg in ipairs(Workspace:GetDescendants()) do
        if table.find(EGG_NAMES, egg.Name) then
            local sv = ensureCurrentPet(egg)
            sv.Value = PET_POOL[egg.Name][math.random(1, #PET_POOL[egg.Name])]
            updateEggUI(egg)
        end
    end
end

-- UI with modern rounded design
local function createControlPanel()
    if player.PlayerGui:FindFirstChild("ControlGui") then return end

    local gui = Instance.new("ScreenGui", player:WaitForChild("PlayerGui"))
    gui.Name = "ControlGui"
    gui.ResetOnSpawn = false

    local frame = Instance.new("Frame", gui)
    frame.Size = UDim2.new(0, 260, 0, 300)
    frame.Position = UDim2.new(0.02, 0, 0.25, 0)
    frame.BackgroundColor3 = Color3.fromRGB(0, 90, 90)
    frame.BorderSizePixel = 0
    frame.Active = true
    frame.Draggable = true  -- Ensure the UI is draggable
    frame.ClipsDescendants = true

    local corner = Instance.new("UICorner", frame)
    corner.CornerRadius = UDim.new(0, 12)

    local header = Instance.new("TextLabel", frame)
    header.Size = UDim2.new(1, 0, 0, 30)
    header.Text = "MaoMao’s Pet Randomizer"
    header.BackgroundColor3 = Color3.fromRGB(40, 80, 60)
    header.TextColor3 = Color3.new(1, 1, 1)
    header.Font = Enum.Font.GothamBold
    header.TextScaled = true
    header.BorderSizePixel = 0
    Instance.new("UICorner", header).CornerRadius = UDim.new(0, 12)

    local stopResumeButton = Instance.new("TextButton", frame)
    stopResumeButton.Size = UDim2.new(1, -20, 0, 40)
    stopResumeButton.Position = UDim2.new(0, 10, 0, 40)
    stopResumeButton.Text = running and "Stop" or "Resume"
    stopResumeButton.Font = Enum.Font.GothamBold
    stopResumeButton.TextScaled = true
    stopResumeButton.TextColor3 = Color3.new(1, 1, 1)
    stopResumeButton.BackgroundColor3 = Color3.fromRGB(128, 90, 200)
    stopResumeButton.BorderSizePixel = 0
    Instance.new("UICorner", stopResumeButton).CornerRadius = UDim.new(0, 8)

    stopResumeButton.MouseButton1Click:Connect(function()
        running = not running
        stopResumeButton.Text = running and "Stop" or "Resume"
        if running then
            randomizeAllEggs()
        end
    end)

    local autoBtn = Instance.new("TextButton", frame)
    autoBtn.Size = UDim2.new(1, -20, 0, 40)
    autoBtn.Position = UDim2.new(0, 10, 0, 90)
    autoBtn.Text = "Auto Stop: ON"
    autoBtn.Font = Enum.Font.GothamBold
    autoBtn.TextScaled = true
    autoBtn.TextColor3 = Color3.new(1, 1, 1)
    autoBtn.BackgroundColor3 = Color3.fromRGB(0, 150, 140)
    autoBtn.BorderSizePixel = 0
    Instance.new("UICorner", autoBtn).CornerRadius = UDim.new(0, 8)

    autoBtn.MouseButton1Click:Connect(function()
        autoStopEnabled = not autoStopEnabled
        autoBtn.Text = "Auto Stop: " .. (autoStopEnabled and "ON" or "OFF")
        rerollButton.AutoButtonColor = not autoStopEnabled
        rerollButton.Active = not autoStopEnabled
        autoBtn.BackgroundColor3 = autoStopEnabled and Color3.fromRGB(0, 150, 140) or Color3.fromRGB(0, 110, 100)
    end)

    local petList = Instance.new("Frame", frame)
    petList.Size = UDim2.new(1, -20, 0, 120)
    petList.Position = UDim2.new(0, 10, 0, 140)
    petList.BackgroundColor3 = Color3.fromRGB(15, 10, 25)
    petList.BorderSizePixel = 0
    Instance.new("UICorner", petList).CornerRadius = UDim.new(0, 8)

    local scroll = Instance.new("ScrollingFrame", petList)
    scroll.Size = UDim2.new(1, 0, 1, 0)
    scroll.CanvasSize = UDim2.new(0, 0, 0, #AUTO_STOP_PET_NAMES * 18 + 20)
    scroll.ScrollBarThickness = 4
    scroll.BackgroundTransparency = 1

    local layout = Instance.new("UIListLayout", scroll)
    layout.Padding = UDim.new(0, 2)
    layout.SortOrder = Enum.SortOrder.LayoutOrder

    local desiredPetsLabel = Instance.new("TextLabel", scroll)
    desiredPetsLabel.Size = UDim2.new(1, 0, 0, 20)
    desiredPetsLabel.Text = "Desired Pets"
    desiredPetsLabel.Font = Enum.Font.GothamBold
    desiredPetsLabel.TextSize = 16
    desiredPetsLabel.TextColor3 = Color3.new(1, 1, 1)
    desiredPetsLabel.BackgroundTransparency = 1
    desiredPetsLabel.TextXAlignment = Enum.TextXAlignment.Left

    for _, name in ipairs(AUTO_STOP_PET_NAMES) do
        local label = Instance.new("TextLabel", scroll)
        label.Size = UDim2.new(1, -4, 0, 18)
        label.Text = "• " .. name
        label.Font = Enum.Font.Gotham
        label.TextSize = 14
        label.TextColor3 = Color3.new(1, 1, 1)
        label.BackgroundTransparency = 1
        label.TextXAlignment = Enum.TextXAlignment.Left
    end

    -- Remove any unnecessary input handling for dragging
    -- The Draggable property should suffice for making the frame movable.
end

-- UI updater only
task.spawn(function()
    while true do
        if running then
            countdown -= 1
            if countdown <= 0 then
                countdown = RANDOMIZE_INTERVAL
                randomizeAllEggs()
            end
        end
        for _, egg in ipairs(Workspace:GetDescendants()) do
            if table.find(EGG_NAMES, egg.Name) then
                updateEggUI(egg)
            end
        end
        task.wait(0.33)  -- Speed up the timer by reducing the wait time
    end
end)

createControlPanel()
randomizeAllEggs()
